{"$schema":"https://dataexplorer.azure.com/static/d/schema/34/dashboard.json","id":"cd3a369f-1ce4-4b52-b641-6aa28b83c4ab","eTag":"el/fqnnBtOkyeWCCpOqdTw==","schema_version":"34","title":"CSU Overview POC 2","autoRefresh":{"enabled":false},"sharedQueries":[],"tiles":[{"id":"48afb1fd-8c60-4dfa-970b-cdd24df379a3","title":"Top 10 RS failure http status 5XX","layout":{"x":0,"y":1,"width":16,"height":7},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"pie","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| where httpStatus >= 500\n| summarize Total=count()\nby case(apiController == apiAction, apiController, isnull(apiController), apiAction, strcat(apiController, '/', apiAction))//, cloud_RoleInstance\n| order by Total desc\n| limit 10\n\n","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":true,"drillthroughDisabled":false,"labelDisabled":false,"pie__label":["name","percentage"],"tooltipDisabled":false,"pie__tooltip":["name","percentage","value"],"pie__orderBy":"size","pie__kind":"pie","multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"3a40d89b-e994-4380-bb78-5bcfbb702165","title":"Top 10 RS failure http status 4XX","layout":{"x":0,"y":80,"width":15,"height":8},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"pie","query":{"kind":"inline","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"},"usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| where httpStatus >= 400 and httpStatus < 500\n| summarize Total=count()\nby case(apiController == apiAction, apiController, isnull(apiController), apiAction, strcat(apiController, '/', apiAction))\n| order by Total desc\n| limit 10\n"},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":true,"drillthroughDisabled":false,"labelDisabled":false,"pie__label":["name","percentage"],"tooltipDisabled":false,"pie__tooltip":["name","percentage","value"],"pie__orderBy":"size","pie__kind":"pie","multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"pie__topNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"047d5746-cf1d-4107-9118-ab05fb3c3c95","title":"Overall Table Summary (RS related Table can be filtered by \"ApiAction\",\"ApiController\".\"ScaleUnit and \"ServerName\")","layout":{"x":0,"y":41,"width":24,"height":1},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"markdownCard","query":{"kind":"inline","usedVariables":[],"text":""},"visualOptions":{"pie__TopNSlices":null}},{"id":"e0651a6b-5433-4697-a3ed-5977b068eb88","title":"RS Performance (in ms)","layout":{"x":0,"y":33,"width":24,"height":8},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"timechart","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| summarize \nResponseTime50=percentile(dur, 50),\nResponseTime99=percentile(dur, 99)\nby bin(timestamp, 1m), Machine=case(cloud_RoleName has \"dr\", \"su-dr\", strcat(cloud_RoleName, ':', cloud_RoleInstance))\n| order by Machine desc\n","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"yAxisMinimumValue":{"type":"infer"},"yAxisMaximumValue":{"type":"infer"},"xAxisScale":"linear","yAxisScale":"linear","hideLegend":false,"xColumnTitle":"","yColumnTitle":"","horizontalLine":"","verticalLine":"","crossFilterDisabled":true,"hideTileTitle":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","columns":[],"label":"","yAxisMinimumValue":null,"yAxisMaximumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"795b344b-8237-4074-8330-3dc1a212acaf","title":"RS Total Requests","layout":{"x":0,"y":17,"width":24,"height":9},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"timechart","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| summarize \nTotal = count()\nby bin(timestamp, 1m), httpStatus","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"xColumn":{"type":"specified","value":"timestamp"},"yColumns":{"type":"specified","value":["Total"]},"seriesColumns":{"type":"specified","value":["httpStatus"]},"yAxisMinimumValue":{"type":"infer"},"yAxisMaximumValue":{"type":"infer"},"xAxisScale":"linear","yAxisScale":"linear","hideLegend":false,"xColumnTitle":"","yColumnTitle":"","verticalLine":"","crossFilterDisabled":true,"hideTileTitle":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","columns":[],"label":"","yAxisMinimumValue":null,"yAxisMaximumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"2ec8de4d-8050-4d33-b770-51b2bafb5440","title":"Other Misc Information","layout":{"x":0,"y":60,"width":24,"height":1},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"markdownCard","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","ClientLogonErrorCodeList","End","EnvironmentId","POSAppSessionId","SpecialFilters","Start"],"text":""},"visualOptions":{"pie__TopNSlices":null}},{"id":"be150c37-51d8-45ac-b128-b39a49a0d123","title":"SQL or RTS Overall (in ms) - filtered by \"ScaleUnit\" and \"ServerName\")","layout":{"x":0,"y":61,"width":24,"height":8},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"table","query":{"kind":"inline","usedVariables":["End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId == 1809 or customDimensions .EventId == 1804 or customDimensions.EventId == 6902\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend latency = toint(customDimensions.executionTimeMilliseconds)\n| extend sqlOrRTS = coalesce(tostring(customDimensions.fromClause), tostring(customDimensions.storedProcedureName), tostring(customDimensions.methodName))\n| extend sqlOrRTSFailed = case(customDimensions.callWasSuccessful == \"False\" or customDimensions.success == \"False\", 1, 0)\n| summarize Total= count(), FailedCount=sum(sqlOrRTSFailed), percentiles(latency, 50, 90, 99, 100) by sqlOrRTS\n| order by Total desc","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"table__enableRenderLinks":true,"hideTileTitle":false,"colorRulesDisabled":false,"crossFilterDisabled":true,"drillthroughDisabled":false,"colorRules":[],"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[],"table__renderLinks":[]}},{"id":"743ce89c-b672-4785-b015-2ff04f1179b5","title":"RS Succeed vs Failure","layout":{"x":0,"y":42,"width":24,"height":8},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"table","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| summarize Total=count(), \nFailure=countif(httpStatus>=500), \nClientFailure=countif(httpStatus>=400 and httpStatus<500), \nResponseTime50=percentile(dur, 50),\nResponseTime99=percentile(dur, 99),\nResponseTime999=percentile(dur, 99.9),\nResponseTime100=percentile(dur, 100)\nby apiController, apiAction//, cloud_RoleInstance\n| order by Failure desc, ClientFailure desc, Total desc","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"table__enableRenderLinks":true,"colorRulesDisabled":false,"crossFilterDisabled":false,"hideTileTitle":false,"drillthroughDisabled":false,"colorRules":[{"id":"7c18eec6-d716-4db2-89a3-64e00760e3b7","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"FailureLink","color":"blue","tag":" ","icon":"globe","conditions":[{"column":"FailureLink","operator":">","values":[""]}],"visualType":"table"},{"id":"1b031615-0af2-42b3-afc8-59784fc1ac6a","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"ClientFailureLink","color":"blue","tag":" ","icon":"globe","conditions":[{"column":"ClientFailureLink","operator":">","values":[""]}],"visualType":"table"},{"id":"18b9f055-da6f-466b-bde2-2e9eabcbf755","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"SlowPerfLink","color":"blue","tag":" ","icon":"globe","conditions":[{"column":"SlowPerfLink","operator":">","values":[""]}],"visualType":"table"}],"pie__TopNSlices":null,"crossFilter":[{"interaction":"column","property":"apiAction","parameterId":"7183b7e2-5528-46cf-a9aa-45a8b8efd987","disabled":false}],"drillthrough":[],"table__renderLinks":[{"urlColumn":"FailureLink","disabled":false},{"urlColumn":"ClientFailureLink","disabled":false},{"urlColumn":"SlowPerfLink","disabled":false}]}},{"id":"9f182c1b-092a-4b25-b9d1-659a7d7f296e","title":"ScaleUnit - Slow Perf.","layout":{"x":15,"y":80,"width":9,"height":8},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"bar","query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId==5009\n| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend activityId = tostring(customDimensions.ActivityId)\n| extend httpStatus = toint(customDimensions.httpStatus)\n| extend apiController = tostring(customDimensions.apiController)\n| extend apiAction = tostring(customDimensions.apiAction)\n| extend dur = toint(customDimensions.executionTimeMilliseconds)\n| where httpStatus >= 400 and httpStatus < 500\n| summarize ResponseTime99 = percentile(dur/1000.0, 99),\nResponseTimeCountLongerThan5Seconds=countif(dur>=5000),\nResponseTimeCountLongerThan10Seconds=countif(dur>=10000)\nby cloud_RoleName\n| order by (ResponseTimeCountLongerThan5Seconds+ ResponseTimeCountLongerThan10Seconds) desc\n| limit 10\n","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[{"interaction":"column","property":"cloud_RoleName","parameterId":"e55ba3ee-a5f4-4e6c-9619-e95c65b7c8e0","disabled":false}],"drillthrough":[]}},{"id":"8fedd5aa-8253-47f8-8efc-5a78cc1b9a29","title":"General Indicators","layout":{"x":0,"y":0,"width":24,"height":1},"pageId":"c804dda4-e091-43e1-8754-4323cd02f483","visualType":"markdownCard","query":{"kind":"inline","usedVariables":[],"text":""},"visualOptions":{"pie__TopNSlices":null}},{"id":"6610376f-7872-42bd-850a-085f2f7f5783","title":"API Volume","visualType":"column","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":16,"y":1,"width":8,"height":7},"query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","ScaleUnitName","ServerName","Start"],"text":"traces\n| where timestamp between (['Start'] .. ['End']) // Time range filtering\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId == 5009\n| where customDimensions.apiController == ['ApiController'] or isempty(['ApiController'])\n| where customDimensions.apiAction == ['ApiAction'] or isempty(['ApiAction'])\n| extend latency = tolong(customDimensions.executionTimeMilliseconds)\n| summarize Total_API_Calls = count() by bin(timestamp, 1m)\n\n","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"bdbad040-1abf-4452-a57a-0f6692176d44","title":"Overall Retail API performance","visualType":"table","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":0,"y":8,"width":24,"height":9},"query":{"kind":"inline","usedVariables":["ApiAction","ApiController","End","Start"],"text":"let CDate = Start - 14d;\nlet Latency = (traces\n    | where timestamp between (['Start'] .. ['End']) // Time range filtering\n    | where customDimensions.EventId == 5009\n    | where customDimensions.apiController == ['ApiController'] or isempty(['ApiController'])\n    | where customDimensions.apiAction == ['ApiAction'] or isempty(['ApiAction'])\n    | extend latency = toint(customDimensions.executionTimeMilliseconds) // executionTimeMs RSSU\n    | extend apiAction = tostring(customDimensions.apiAction)\n    | extend apiController = tostring(customDimensions.apiController)\n    | extend api = strcat(apiController,\"\\\\\",apiAction)\n    | summarize count(), avg(latency), percentiles(latency, 50, 95) by api\n    | order by percentile_latency_95 desc\n);\nlet 14Days_AVG_Latency = (traces \n    | where timestamp between(CDate .. Start)\n    | where customDimensions.EventId == 5009\n    | where customDimensions.apiController == ['ApiController'] or isempty(['ApiController'])\n    | where customDimensions.apiAction == ['ApiAction'] or isempty(['ApiAction'])\n    | extend latency = toint(customDimensions.executionTimeMilliseconds) // executionTimeMs RSSU\n    | extend apiAction = tostring(customDimensions.apiAction)\n    | extend apiController = tostring(customDimensions.apiController)\n    | extend api = strcat(apiController,\"\\\\\",apiAction)\n    | summarize avg(latency) by api\n    | project-rename 14Days_AVG_Latency = avg_latency\n);\nLatency\n| join kind = inner (14Days_AVG_Latency) on api\n| project-away api1\n| extend Deviation = avg_latency - 14Days_AVG_Latency\n| project api, count_, round(14Days_AVG_Latency,3), round(avg_latency,3), toint(Deviation), percentile_latency_50, percentile_latency_95\n| project api, count_, round(14Days_AVG_Latency,3), round(avg_latency,3), toint(Deviation), percentile_latency_50, percentile_latency_95\n| order by Deviation desc\n","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"visualOptions":{"hideTileTitle":false,"table__enableRenderLinks":false,"colorRulesDisabled":false,"crossFilterDisabled":false,"drillthroughDisabled":false,"colorRules":[{"id":"a025156e-67a5-46b4-a415-d8bcf2058db3","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"Deviation","color":"yellow","tag":"Warning","icon":null,"conditions":[{"column":"Deviation","operator":">","values":["500"]},{"column":"Deviation","operator":"<=","values":["1000"]}],"visualType":"table"},{"id":"fe4fa23d-7df7-4077-b455-737c78843226","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"Deviation","color":"red","tag":"Critical","icon":null,"conditions":[{"column":"Deviation","operator":">","values":["1000"]}],"visualType":"table"},{"id":"7470d474-a0ca-4a5f-80fd-0ee869aba04f","ruleType":"colorByCondition","ruleName":"","applyTo":"cells","chainingOperator":"and","colorStyle":"light","hideText":false,"applyToColumn":"Deviation","color":"green","tag":"Healthy","icon":null,"conditions":[{"column":"Deviation","operator":"<=","values":["500"]}],"visualType":"table"}],"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[],"table__renderLinks":[{"urlColumn":"14Days_AVG_Latency","disabled":false}]}},{"id":"ea989308-7b49-4170-a05c-886fe96e27d4","title":"Top API's Tracking ","visualType":"line","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":0,"y":69,"width":24,"height":11},"query":{"kind":"inline","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"},"usedVariables":["End","ScaleUnitName","ServerName","Start"],"text":"let targetApis = datatable(api:string)\n[\n\"/Commerce/Products/GetCategoryPaths\",\n\"/Commerce/Products/GetActivePrices\",\n\"/Commerce/Carts\",\n\"/Commerce/Carts/Copy\", \"/Commerce/Carts/RemoveCartLines\",\n\"/Commerce/Carts/Checkout\",\n\"/Commerce/Customers\"\n];\nlet targetApi = \"\";\nlet latencyCap = 10000.0;\nlet window = 1m;\ntraces\n| where timestamp between (Start .. End)\n| extend ScaleUnitId = tostring(customDimensions.ScaleUnitId)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId == 5009\n| extend HttpResultStatus = tostring(customDimensions .httpStatus)\n| extend RequestUri = parse_url(tostring(customDimensions .requestUri))\n| extend Url = customDimensions .requestUri\n| extend Path = tostring(RequestUri.Path)\n| extend NormalizedPath = replace(@'\\([^)]*\\)', \"\", Path)\n| extend LowerNormalizedPath = tolower(NormalizedPath)\n| join kind=inner\n(targetApis | extend LowerNormalizedPath = tolower(api))\non LowerNormalizedPath\n| extend Latency = tolong(customDimensions.executionTimeMilliseconds)\n//| where HttpResultStatus == 200\n| where targetApi == \"\" or NormalizedPath contains targetApi\n| extend HttpResultStatus = toint(customDimensions .httpStatus)\n| extend ResponseType = case(HttpResultStatus < 400, \"Success\", HttpResultStatus < 500, \"Warning\", \"Error\")\n| extend IsFailure = case(HttpResultStatus < 500, false, true)\n//| order by timestamp desc | limit 10000\n| summarize\n//Average = avg(Latency),\n//CappedLatency = min_of(avg(Latency), latencyCapForGraph) ,\nCallCount = count() ,\nLatency_Avg = avg(Latency),\nLatency_p50 = percentile(Latency, 50),\nLatency_p75 = percentile(Latency, 75),\nLatency_p90 = percentile(Latency, 90),\nSuccessCount = countif(not(IsFailure)),\nFailureCount = countif(IsFailure)\n//max(Latency),\nby bin(timestamp, window)\n, LowerNormalizedPath\n//,HttpResultStatus\n| extend FailureRate = todecimal(FailureCount) / todecimal(CallCount)\n| extend Reliability = 1.0 - FailureRate\n| extend Latency_CappedAvg = case(Latency_Avg > latencyCap, latencyCap, Latency_Avg)\n| order by timestamp desc, LowerNormalizedPath\n"},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["Latency_p90","Latency_Avg"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"00d11bc7-91bd-433b-9da0-5b5d8885c29a","title":"Top API's Tracking","visualType":"table","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":0,"y":26,"width":24,"height":7},"query":{"kind":"inline","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"},"usedVariables":["End","ScaleUnitName","ServerName","Start"],"text":"let targetApis = datatable(api:string)\n[\n\"/Commerce/Products/GetCategoryPaths\",\n\"/Commerce/Products/GetActivePrices\",\n\"/Commerce/Carts\",\n\"/Commerce/Carts/Copy\", \"/Commerce/Carts/RemoveCartLines\",\n\"/Commerce/Carts/Checkout\",\n\"/Commerce/Customers\"\n];\nlet targetApi = \"\";\nlet latencyCap = 10000.0;\nlet window = 1m;\ntraces\n| where timestamp between (Start .. End)\n| extend ScaleUnitId = tostring(customDimensions.ScaleUnitId)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId == 5009\n| extend HttpResultStatus = tostring(customDimensions .httpStatus)\n| extend RequestUri = parse_url(tostring(customDimensions .requestUri))\n| extend Url = customDimensions .requestUri\n| extend Path = tostring(RequestUri.Path)\n| extend NormalizedPath = replace(@'\\([^)]*\\)', \"\", Path)\n| extend LowerNormalizedPath = tolower(NormalizedPath)\n| join kind=inner\n(targetApis | extend LowerNormalizedPath = tolower(api))\non LowerNormalizedPath\n| extend Latency = tolong(customDimensions.executionTimeMilliseconds)\n//| where HttpResultStatus == 200\n| where targetApi == \"\" or NormalizedPath contains targetApi\n| extend HttpResultStatus = toint(customDimensions .httpStatus)\n| extend ResponseType = case(HttpResultStatus < 400, \"Success\", HttpResultStatus < 500, \"Warning\", \"Error\")\n| extend IsFailure = case(HttpResultStatus < 500, false, true)\n//| order by timestamp desc | limit 10000\n| summarize\n//Average = avg(Latency),\n//CappedLatency = min_of(avg(Latency), latencyCapForGraph) ,\nCallCount = count() ,\nLatency_Avg = avg(Latency),\nLatency_p50 = percentile(Latency, 50),\nLatency_p75 = percentile(Latency, 75),\nLatency_p90 = percentile(Latency, 90),\nSuccessCount = countif(not(IsFailure)),\nFailureCount = countif(IsFailure)\n//max(Latency),\nby bin(timestamp, window)\n, LowerNormalizedPath\n//,HttpResultStatus\n| extend FailureRate = todecimal(FailureCount) / todecimal(CallCount)\n| extend Reliability = 1.0 - FailureRate\n| extend Latency_CappedAvg = case(Latency_Avg > latencyCap, latencyCap, Latency_Avg)\n| order by timestamp desc, LowerNormalizedPath\n\n"},"visualOptions":{"hideTileTitle":false,"table__enableRenderLinks":true,"colorRulesDisabled":true,"crossFilterDisabled":false,"drillthroughDisabled":false,"colorRules":[],"colorStyle":"light","pie__TopNSlices":null,"crossFilter":[],"drillthrough":[],"table__renderLinks":[]}},{"id":"25ee1662-fd1d-454a-93d4-af7d0c72d742","title":"Top API's Tracking  / WIP","visualType":"line","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":0,"y":88,"width":24,"height":11},"query":{"kind":"inline","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"},"usedVariables":["End","ScaleUnitName","ServerName","Start"],"text":"let targetApis = datatable(api:string)\n[\n//Upper Funnel: GetProductsCategoryPathsAction  ???????\n//Upper Funnel: WebServiceClient ???????????????\n//Shopping: GetByID ????????????????\n//Shopping: GetFeatureState ???????????\n\"/Commerce/Carts/RemoveCartLines\",\n\"/Commerce/OrgUnits/GetOrgUnitLocationsByArea\",\n\"/Commerce/Products/GetActivePrices\",\n\"/Commerce/Products/GetCategoryPaths\",\n\"/Commerce/Carts\",\n\"/Commerce/Products/GetAttributeValues\",\n\"/Commerce/Carts/GetCardPaymentAcceptPoint\",\n\"/Commerce/Carts/RetrieveCardPaymentAcceptResult\",\n\"/Commerce/Products/GetDeliveryOptions\",\n\"/Commerce/Carts/Checkout\",\n\"/Commerce/Carts/Copy\",\n\"/Commerce/Customers\"\n];\nlet targetApi = \"\";\nlet latencyCap = 10000.0;\nlet window = 1m;\ntraces\n| where timestamp between (Start .. End)\n| extend ScaleUnitId = tostring(customDimensions.ScaleUnitId)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| where case (isempty(ServerName), true, cloud_RoleInstance in (ServerName))\n| where customDimensions.EventId == 5009\n//| where case (isempty(ApiController), true, customDimensions.apiController==ApiController)\n//| where case (isempty(ApiAction), true, customDimensions.apiAction==ApiAction)\n| extend HttpResultStatus = tostring(customDimensions .httpStatus)\n| extend RequestUri = parse_url(tostring(customDimensions .requestUri))\n| extend Url = customDimensions .requestUri\n| extend Path = tostring(RequestUri.Path)\n| extend NormalizedPath = replace(@'\\([^)]*\\)', \"\", Path)\n| extend LowerNormalizedPath = tolower(NormalizedPath)\n| join kind=inner\n(targetApis | extend LowerNormalizedPath = tolower(api))\non LowerNormalizedPath\n| extend Latency = tolong(customDimensions.executionTimeMilliseconds)\n//| where HttpResultStatus == 200\n| where targetApi == \"\" or NormalizedPath contains targetApi\n| extend HttpResultStatus = toint(customDimensions .httpStatus)\n| extend ResponseType = case(HttpResultStatus < 400, \"Success\", HttpResultStatus < 500, \"Warning\", \"Error\")\n| extend IsFailure = case(HttpResultStatus < 500, false, true)\n//| order by timestamp desc | limit 10000\n| summarize\n//Average = avg(Latency),\n//CappedLatency = min_of(avg(Latency), latencyCapForGraph) ,\nCallCount = count() ,\nLatency_Avg = avg(Latency),\nLatency_p50 = percentile(Latency, 50),\nLatency_p75 = percentile(Latency, 75),\nLatency_p90 = percentile(Latency, 90),\nSuccessCount = countif(not(IsFailure)),\nFailureCount = countif(IsFailure)\n//max(Latency),\nby bin(timestamp, window)\n, LowerNormalizedPath\n//,HttpResultStatus\n| extend FailureRate = todecimal(FailureCount) / todecimal(CallCount)\n| extend Reliability = 1.0 - FailureRate\n| extend Latency_CappedAvg = case(Latency_Avg > latencyCap, latencyCap, Latency_Avg)\n| order by timestamp desc, LowerNormalizedPath\n"},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["Latency_p90","Latency_Avg"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}},{"id":"285dec92-df7f-4822-b394-9f7fa0b1b2d2","title":"New tile","visualType":"stackedcolumn","pageId":"c804dda4-e091-43e1-8754-4323cd02f483","layout":{"x":0,"y":50,"width":24,"height":10},"query":{"kind":"inline","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"},"usedVariables":[],"text":"traces\n| where customDimensions.EventId == 5009 // designates a RetailServer finished \n| extend executionTimeMilliseconds = toint(customDimensions.executionTimeMilliseconds)\n| extend apiAction = customDimensions.apiAction\n| project executionTimeMilliseconds, apiAction\n| summarize NumAllCalls=count(), AvgDuration = avg(executionTimeMilliseconds),\npercentile90 =percentiles(executionTimeMilliseconds, 90) by tostring(apiAction)\n| where percentile90 > 100\n| order by percentile90 desc\n| project apiAction, percentile90\n| render columnchart\n\n"},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[],"showMultiplePanels":false},"hideLegend":false,"xColumnTitle":"","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"drillthroughDisabled":false,"pie__TopNSlices":null,"crossFilter":[],"drillthrough":[]}}],"parameters":[{"kind":"duration","id":"d19e7c92-3b08-43e2-a57d-f5f1bf9257f8","displayName":"Time range","beginVariableName":"Start","endVariableName":"End","defaultValue":{"kind":"dynamic","count":30,"unit":"minutes"},"showOnPages":{"kind":"all"}},{"kind":"string","id":"7183b7e2-5528-46cf-a9aa-45a8b8efd987","displayName":"ApiAction","variableName":"ApiAction","selectionType":"scalar","includeAllOption":true,"defaultValue":{"kind":"all"},"dataSource":{"kind":"query","query":{"kind":"inline","usedVariables":["End","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where customDimensions.EventId == 5009\n| extend ApiController = tostring(customDimensions.apiController)\n| extend ApiAction = tostring(customDimensions.apiAction)\n| summarize Total = count()\nby ApiAction\n| order by Total desc","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"columns":{"value":"ApiAction","label":"ApiAction"}},"showOnPages":{"kind":"all"}},{"kind":"string","id":"bf1ad38f-843c-4ceb-afde-d553bd8a0535","displayName":"ApiController","variableName":"ApiController","selectionType":"scalar","includeAllOption":true,"defaultValue":{"kind":"all"},"dataSource":{"kind":"query","query":{"kind":"inline","usedVariables":["End","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where customDimensions.EventId==5009\n| extend ApiController = tostring(customDimensions.apiController)\n| extend ApiAction = tostring(customDimensions.apiAction)\n| summarize Total=count()\nby ApiController\n| order by Total desc","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"columns":{"value":"ApiController","label":"ApiController"}},"showOnPages":{"kind":"all"}},{"kind":"string","id":"e55ba3ee-a5f4-4e6c-9619-e95c65b7c8e0","displayName":"ScaleUnit","variableName":"ScaleUnitName","selectionType":"array","includeAllOption":true,"defaultValue":{"kind":"all"},"dataSource":{"kind":"query","query":{"kind":"inline","usedVariables":["End","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| summarize any(cloud_RoleName) by cloud_RoleName\n| order by cloud_RoleName","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"columns":{"value":"cloud_RoleName","label":"cloud_RoleName"}},"showOnPages":{"kind":"all"}},{"kind":"string","id":"a0158c9e-38d2-4d25-a9ba-cb7950ea5449","displayName":"ServerName","variableName":"ServerName","selectionType":"array","includeAllOption":true,"defaultValue":{"kind":"all"},"dataSource":{"kind":"query","query":{"kind":"inline","usedVariables":["End","ScaleUnitName","Start"],"text":"traces\n| where timestamp between (Start .. End)\n| where case (isempty(ScaleUnitName), true, cloud_RoleName in (ScaleUnitName))\n| summarize any(cloud_RoleInstance) by cloud_RoleInstance\n| order by cloud_RoleInstance desc","dataSource":{"kind":"inline","dataSourceId":"d0d17c7b-ec27-40e6-8395-69b373699c29"}},"columns":{"value":"cloud_RoleInstance","label":"cloud_RoleInstance"}},"showOnPages":{"kind":"all"}}],"dataSources":[{"id":"d0d17c7b-ec27-40e6-8395-69b373699c29","name":"crt-prd","clusterUri":"https://ade.applicationinsights.io/subscriptions/SubscriptionNumberPlaceHolder/resourcegroups/ResourcegroupNamePlaceHolder/providers/microsoft.insights/components/ApplicationsInsightsNamePlaceHolder","database":"D365Commerce-OperationalInsights","kind":"manual-kusto","scopeId":"kusto"},{"id":"4f8f3624-6130-4def-ae45-a6a9c0c7fec5","name":"atp-prd","clusterUri":"https://ade.applicationinsights.io/subscriptions/SubscriptionNumber/resourcegroups/ResourcegroupName/providers/microsoft.insights/components/ApplicationsInsightsName","database":"D365Commerce-OperationalInsights","kind":"manual-kusto","scopeId":"kusto"},{"id":"0579f672-d43a-4537-be09-39356f262911","name":"prodatpcache","clusterUri":"https://ade.applicationinsights.io/subscriptions/SubscriptionNumberPlaceHolder/resourcegroups/ResourcegroupNamePlaceHolder/providers/microsoft.insights/components/ApplicationsInsightsNamePlaceHolder","database":"D365Commerce-OperationalInsights","kind":"manual-kusto","scopeId":"kusto"}],"pages":[{"name":"D365","id":"c804dda4-e091-43e1-8754-4323cd02f483"}]}